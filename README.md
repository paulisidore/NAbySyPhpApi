# NAbySyGS - Framework PHP avec ORM Int√©gr√©

[![Latest Version](https://img.shields.io/packagist/v/nabysyphpapi/xnabysygs.svg)](https://packagist.org/packages/nabysyphpapi/xnabysygs)
[![Total Downloads](https://img.shields.io/packagist/dt/nabysyphpapi/xnabysygs.svg)](https://packagist.org/packages/nabysyphpapi/xnabysygs)
[![License](https://img.shields.io/packagist/l/nabysyphpapi/xnabysygs.svg)](https://packagist.org/packages/nabysyphpapi/xnabysygs)
[![PHP Version](https://img.shields.io/packagist/php-v/nabysyphpapi/xnabysygs.svg)](https://packagist.org/packages/nabysyphpapi/xnabysygs)

**NAbySyGS** est un framework PHP moderne con√ßu par **PAM & MCP** pour faciliter la cr√©ation rapide d'API REST pour vos applications. Il int√®gre un ORM personnalis√© avec cr√©ation automatique de tables et champs, un syst√®me d'authentification JWT, et une architecture modulaire.

## ‚ú® Fonctionnalit√©s

- üöÄ **ORM Automatique** - Cr√©ation automatique des tables et champs MySQL/MariaDB
- üîê **Authentification JWT** - Syst√®me de tokens s√©curis√©s int√©gr√©
- üì¶ **Architecture Modulaire** - Organisation en modules avec auto-chargement
- üéØ **Type-Safe** - D√©tection automatique des types de donn√©es (INT, VARCHAR, DATE...)
- üîÑ **Gestion d'√âv√©nements** - Pattern Observer pour r√©agir aux changements
- üõ†Ô∏è **Modules M√©tier** - Gestion de boutiques, stocks, factures, clients...
- üåê **CORS Ready** - Gestion automatique des requ√™tes cross-origin
- üìù **Logs Int√©gr√©s** - Journalisation syst√®me et d√©bogage

## üìã Pr√©requis

- PHP >= 8.1.0
- MySQL ou MariaDB
- Extension PHP: `mysqli`, `mbstring`, `json`
- Composer

## üì¶ Installation

### Via Composer

```bash
composer require nabysyphpapi/xnabysygs
```

### Structure G√©n√©r√©e

```
votre-projet/
‚îú‚îÄ‚îÄ vendor/
‚îÇ   ‚îî‚îÄ‚îÄ nabysyphpapi/xnabysygs/
‚îú‚îÄ‚îÄ gs/                    # Modules personnalis√©s (cr√©√©s automatiquement)
‚îú‚îÄ‚îÄ appinfos.php          # Configuration (cr√©√© automatiquement)
‚îú‚îÄ‚îÄ .htaccess             # Redirection API (cr√©√© automatiquement)
‚îî‚îÄ‚îÄ index.php             # Point d'entr√©e
```

## üöÄ D√©marrage Rapide

### 1. Configuration Initiale

Cr√©ez un fichier `index.php` √† la racine :

```php
<?php
require 'vendor/autoload.php';

use NAbySy\xNAbySyGS as N;

// Initialisation
$nabysy = N::Init(
    "MonApp",              // Nom de l'application
    "Ma Soci√©t√© SARL",     // Nom du client
    "123 Rue Example",     // Adresse
    "+221 33 123 45 67",   // T√©l√©phone
    "ma_base",            // Base de donn√©es
    "nabysygs",           // Base master
    "localhost",          // Serveur MySQL
    "root",               // Utilisateur
    "",                   // Mot de passe
    3306                  // Port
);

// Mode debug (d√©veloppement uniquement)
N::SetShowDebug(true);

// Traiter les requ√™tes HTTP
N::ReadHttpRequest();
```

### 2. Cr√©er Votre Premier Module

```php
<?php
use NAbySy\xNAbySyGS as N;

// Cr√©er un module "client" avec action API et classe ORM
N::$GSModManager::CreateCategorie(
    "client",        // Nom du module
    true,           // Cr√©er fichier action
    true,           // Cr√©er classe ORM
    "clients"       // Nom de la table
);
```

Cela g√©n√®re automatiquement :
- `gs/client/client_action.php` - Endpoints API
- `gs/client/xClient/xClient.class.php` - Classe ORM

### 3. Utiliser l'ORM

```php
<?php
use NAbySy\ORM\xORMHelper;

$nabysy = N::getInstance();

// Cr√©er un client
$client = new xORMHelper($nabysy, null, true, "clients");
$client->Nom = "Dupont";
$client->Prenom = "Jean";
$client->Email = "jean@example.com";
$client->Telephone = "771234567";
$client->Enregistrer(); // Sauvegarde

echo "Client cr√©√© avec ID: " . $client->Id;
```

## üìñ Documentation Compl√®te

### ORM - Op√©rations CRUD

#### Cr√©er

```php
<?php
$produit = new xORMHelper($nabysy, null, true, "produits");
$produit->Nom = "Laptop Dell";
$produit->Prix = 550000;
$produit->Stock = 10;
$produit->Enregistrer();
```

#### Lire

```php
<?php
// Par ID
$produit = new xORMHelper($nabysy, 5, true, "produits");
echo $produit->Nom;

// Liste avec crit√®res
$liste = $produit->ChargeListe(
    "Prix > 100000 AND Stock > 0",  // Crit√®re WHERE
    "Nom ASC",                       // ORDER BY
    "*",                             // SELECT
    null,                            // GROUP BY
    "10"                             // LIMIT
);

while ($row = $liste->fetch_assoc()) {
    echo $row['Nom'];
}
```

#### Mettre √† Jour

```php
<?php
$produit = new xORMHelper($nabysy, 5, true, "produits");
$produit->Prix = 500000;
$produit->Enregistrer();
```

#### Supprimer

```php
<?php
$produit = new xORMHelper($nabysy, 5, true, "produits");
$produit->Supprimer();
```

### Conversions de Donn√©es

```php
<?php
// Vers JSON
$json = $produit->ToJSON();

// Vers Object PHP
$obj = $produit->ToObject();

// Vers Array
$array = $produit->ToArrayAssoc();
```

### API REST

#### Structure d'une Action

Fichier `gs/client/client_action.php` :

```php
<?php
use NAbySy\xNotification;
use NAbySy\ORM\xORMHelper;

$action = $_REQUEST['action'] ?? null;

switch ($action) {
    case 'CLIENT_CREATE':
        // V√©rification authentification
        if (!$nabysy->ValideUser()) exit;
        
        $client = new xORMHelper($nabysy, null, true, "clients");
        $client->Nom = $_REQUEST['nom'];
        $client->Telephone = $_REQUEST['telephone'];
        
        if ($client->Enregistrer()) {
            $rep = new xNotification();
            $rep->Contenue = $client->ToObject();
            echo json_encode($rep);
        }
        break;
        
    case 'CLIENT_LIST':
        $client = new xORMHelper($nabysy, null, true, "clients");
        $liste = $client->ChargeListe();
        echo $nabysy->SQLToJSON($liste);
        break;
}
```

#### Appel API

```bash
# Cr√©er un client
curl -X POST https://votre-domaine.com/gs_api.php \
  -H "Content-Type: application/json" \
  -d '{
    "action": "CLIENT_CREATE",
    "nom": "Dupont",
    "telephone": "771234567",
    "Token": "votre_token_jwt"
  }'
```

### Authentification JWT

#### Connexion

```php
<?php
use NAbySy\xUser;
use NAbySy\xAuth;

// Dans votre action auth
$user = new xUser($nabysy, null, true, "utilisateur", $_REQUEST['Login']);

if ($user->CheckPassword($_REQUEST['Password'])) {
    $auth = new xAuth($nabysy, 3600); // Token valide 1h
    $token = $auth->GetToken($user);
    
    echo json_encode([
        'OK' => 1,
        'Token' => $token,
        'User' => $user->ToObject()
    ]);
}
```

#### Protection des Routes

```php
<?php
// Au d√©but de votre action
if (!$nabysy->ValideUser()) {
    // Retourne automatiquement une erreur 401
    exit;
}

// Code prot√©g√©...
```

#### Configuration Session

```php
<?php
// D√©finir une session de 24h (86400 secondes)
N::SetAuthSessionTime(86400);
```

## üõ†Ô∏è Modules Int√©gr√©s

### Module Boutique

```php
<?php
use NAbySy\GS\Boutique\xBoutique;

$boutique = new xBoutique($nabysy, 1);
echo $boutique->Nom;
$liste = $boutique->getListeBoutique();
```

### Module Stock

```php
<?php
use NAbySy\GS\Stock\xProduit;

$produit = new xProduit($nabysy, 10);
$produit->Designation = "Smartphone";
$produit->PrixVente = 150000;
$produit->Enregistrer();
```

### Module Facture

```php
<?php
use NAbySy\GS\Facture\xVente;

$vente = new xVente($nabysy);
$vente->IdClient = 5;
$vente->MontantTotal = 500000;
$vente->Enregistrer();
```

## üîß Configuration Avanc√©e

### Mode Debug

```php
<?php
// Activer les logs SQL d√©taill√©s
$nabysy->ActiveDebug = true;
N::SetShowDebug(true, E_ALL);
```

### Ignorer Certaines Requ√™tes dans les Logs

```php
<?php
N::$RequetteToIgnoreInLOG[] = 'SELECT';
N::$RequetteToIgnoreInLOG[] = 'UPDATE';
```

### Personnalisation du Dossier Racine

```php
<?php
$nabysy = N::Init(
    "MonApp",
    "Ma Soci√©t√©",
    "Adresse",
    "T√©l√©phone",
    "ma_base",
    "nabysygs",
    "localhost",
    "root",
    "",
    3306,
    "mon-dossier"  // Dossier racine personnalis√©
);
```

## üìö Exemples Complets

### API Gestion de Produits

```php
<?php
// gs/produit/produit_action.php
use NAbySy\ORM\xORMHelper;
use NAbySy\xNotification;

switch ($action) {
    case 'PRODUIT_CREATE':
        if (!$nabysy->ValideUser()) exit;
        
        $produit = new xORMHelper($nabysy, null, true, "produits");
        $produit->Nom = $_REQUEST['nom'];
        $produit->Prix = $_REQUEST['prix'];
        $produit->Stock = $_REQUEST['stock'] ?? 0;
        
        if ($produit->Enregistrer()) {
            $rep = new xNotification();
            $rep->Contenue = $produit->ToObject();
            echo json_encode($rep);
        }
        break;
        
    case 'PRODUIT_SEARCH':
        $produit = new xORMHelper($nabysy, null, true, "produits");
        $recherche = $_REQUEST['q'] ?? '';
        
        $liste = $produit->ChargeListe(
            "Nom LIKE '%$recherche%'",
            "Nom ASC",
            "*",
            null,
            "20"
        );
        
        echo $nabysy->SQLToJSON($liste);
        break;
}
```

### Clonage d'Enregistrements

```php
<?php
$produitOriginal = new xORMHelper($nabysy, 5, true, "produits");

// Cloner dans la m√™me base
$clone = $produitOriginal->Clone();

// Cloner vers une autre base
$clone = $produitOriginal->Clone("autre_base");
```

## üéØ Bonnes Pratiques

1. **Toujours utiliser `ValideUser()`** pour prot√©ger vos endpoints sensibles
2. **Nommer vos actions** en MAJUSCULES avec pr√©fixe module : `PRODUIT_CREATE`
3. **Utiliser xNotification** pour les r√©ponses r√©ussies, `xErreur` pour les erreurs
4. **Activer le debug** uniquement en d√©veloppement
5. **Versionner** votre fichier `appinfos.php` pour la configuration personnalis√©e

## üìù Structure de R√©ponse

### Succ√®s

```json
{
    "OK": 1,
    "TxErreur": "",
    "Source": "produit_action.php",
    "Contenue": {
        "Id": 15,
        "Nom": "Laptop Dell",
        "Prix": 550000
    }
}
```

### Erreur

```json
{
    "OK": 0,
    "TxErreur": "Produit introuvable",
    "Source": "produit_action.php",
    "Extra": "V√©rifiez l'ID fourni"
}
```

## ü§ù Contribution

Les contributions sont les bienvenues ! N'h√©sitez pas √† :

1. Fork le projet
2. Cr√©er une branche (`git checkout -b feature/amelioration`)
3. Commit vos changements (`git commit -m 'Ajout fonctionnalit√©'`)
4. Push sur la branche (`git push origin feature/amelioration`)
5. Ouvrir une Pull Request

## üìÑ Licence

MIT License - voir le fichier [LICENSE](LICENSE) pour plus de d√©tails.

## üë®‚Äçüíª Auteur

**Paul Isidore A. NIAMIE**
- Email: paul.isidore@gmail.com
- Website: [https://groupe-pam.net](https://groupe-pam.net)

## üôè Remerciements

D√©velopp√© par **Paul & A√Øcha Machinerie (PAM)** et **MCP**.

---

‚≠ê Si ce projet vous est utile, n'h√©sitez pas √† lui donner une √©toile sur GitHub !